(()=>{"use strict";class i{constructor(i,t){this.pitch=i,this.duration=t}static parse(t){const s=t.match(/^([A-G](bb|b|#|x|)[1-6])(_*)(\/*)(\.*)$/);if(null===s)throw`Could not parse note '${t}'`;return new i(e.parse(s[1]),2**(s[3].length-s[4].length)*1.5**s[5].length)}getPitch(){return this.pitch}setPitch(i){return this.pitch=i,this}getDuration(){return this.duration}setDuration(i){return this.duration=i,this}string(){let i=this.getPitch().string();switch(this.getDuration()){case.25:i+="𝅘𝅥𝅯";break;case.5:i+="♪";break;case.75:i+="♪.";break;case 1:i+="♩";break;case 1.5:i+="♩.";break;case 2:i+="𝅗𝅥";break;case 3:i+="𝅗𝅥.";break;case 4:i+="𝅝";break;case 6:i+="𝅝."}return i}}class t{constructor(i,t){this.notes=i,this.index=t}static parse(e){if(e.startsWith("(")&&e.endsWith(")")){const s=e.slice(1,-1).split(",").map((t=>i.parse(t)));return new t(s,0)}return new t([i.parse(e)],0)}static empty(){return new t([],0)}main(){return this.getNotes()[this.getIndex()]}at(i){return i<0&&(i=this.getNotes().length+i),this.getNotes()[i]}duration(){return this.getNotes().map((i=>i.getDuration())).reduce(((i,t)=>i+t))}getNotes(){return this.notes}setNotes(i){return this.notes=i,this}getIndex(){return this.index}setIndex(i){return this.index=i,this}string(){return this.getNotes().map((i=>i.string())).join(" ")}}class e{constructor(i,t){this.tone=i,this.octave=t}static parse(i){const t=i.match(/^([A-G](bb|b|#|x|))([1-6])$/);if(null===t)throw`Could not parse pitch '${i}'`;return new e(s.parse(t[1]),Number(t[3]))}semitones(){return this.getTone().semitones()+12*this.getOctave()}near(i){return[new e(i,this.getOctave()-1),new e(i,this.getOctave()),new e(i,this.getOctave()+1)].sort(((i,t)=>Math.abs(this.semitones()-i.semitones())-Math.abs(this.semitones()-t.semitones())))}getTone(){return this.tone}setTone(i){return this.tone=i,this}getOctave(){return this.octave}setOctave(i){return this.octave=i,this}string(){return this.getTone().string()+this.getOctave()}group(e){return new t([new i(this,e)],0)}}class s{constructor(i,t){this.letter=i,this.accidental=t}static parse(i){const t=i.match(/^([A-G])(bb|x|b|#|)$/);if(null===t)throw`Could not parse tone '${i}'`;return new s(s.LETTERS.indexOf(t[1]),s.ACCIDENTALS.indexOf(t[2]))}semitones(){return s.PITCHES[this.letter]+this.accidental}equals(i){return void 0!==i&&this.letter===i.letter&&this.accidental===i.accidental}near(i){return[new e(this,i.getOctave()-1),new e(this,i.getOctave()),new e(this,i.getOctave()+1)].sort(((t,e)=>Math.abs(i.semitones()-t.semitones())-Math.abs(i.semitones()-e.semitones())))}getLetter(){return this.letter}setLetter(i){return this.letter=i,this}getAccidental(){return this.accidental}setAccidental(i){return i>=-2&&i<=2&&(this.accidental=i),this}alterAccidental(i){const t=this.accidental+i;return t>=-2&&t<=2&&(this.accidental=t),this}string(){return s.LETTERS[this.letter]+s.ACCIDENTALS[this.accidental]}}s.ACCIDENTALS=["","#","x"],s.ACCIDENTALS[-2]="bb",s.ACCIDENTALS[-1]="b",s.LETTERS=["C","D","E","F","G","A","B"],s.PITCHES=[0,2,4,5,7,9,11];class r{constructor(i,t){this.tone=i,this.tonality=t}static parse(i){const t=i.match(/^(C|D|E|F|G|A|B)(bb|x|b|#|) (major|minor)$/);if(null===t)throw`Could not parse key '${i}'`;return new r(s.parse(t[1]+t[2]),"major"===t[3])}degree(i,t){i%=7,null!=t||(t=(this.getTonality()?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10])[i]);const e=new s((this.getTone().getLetter()+i)%7,0);return e.setAccidental((t-e.semitones()+this.getTone().semitones()+18)%12-6),e}accidentals(){let i=2*this.getTone().getLetter()%7+7*this.getTone().getAccidental();return 3===this.getTone().getLetter()&&(i-=7),this.tonality||(i-=3),i}signature(){const i=this.accidentals();return[Math.floor((i+5)/7),Math.floor((i+3)/7),Math.floor((i+1)/7),Math.floor((i+6)/7),Math.floor((i+4)/7),Math.floor((i+2)/7),Math.floor(i/7)]}getTone(){return this.tone}setTone(i){return this.tone=i,this}getTonality(){return this.tonality}setTonality(i){return this.tonality=i,this}string(){return this.getTone().string()+" "+(this.getTonality()?"major":"minor")}}class n{constructor(i,t,e){this.accidental=i,this.degree=t,this.tonality=e}static parse(i){const t=i.match(/^(b|#|)(III|iii|VII|vii|II|ii|IV|iv|VI|vi|I|i|V|v)$/);if(null===t)throw`Could not parse numeral '${i}'`;return new n(s.ACCIDENTALS.indexOf(t[1]),n.NUMERALS.indexOf(t[2].toLowerCase()),t[2]===t[2].toUpperCase())}getAccidental(){return this.accidental}setAccidental(i){return this.accidental=i,this}getDegree(){return this.degree}setDegree(i){return this.degree=i,this}getTonality(){return this.tonality}setTonality(i){return this.tonality=i,this}string(){return s.ACCIDENTALS[this.accidental]+n.NUMERALS[this.degree][this.tonality?"toUpperCase":"toLowerCase"]()}}n.NUMERALS=["i","ii","iii","iv","v","vi","vii"];class I{constructor(i,t,e,s,r){this.root=i,this.third=t,this.fifth=e,this.seventh=s,this.inversion=r}at(i){switch(i){case 0:return this.root;case 1:return this.third;case 2:return this.fifth;case 3:return this.seventh}}bass(){return this.at(this.inversion)}excludes(i){var t,e,s,r;return void 0!==i&&!((null===(t=this.root)||void 0===t?void 0:t.equals(i))||(null===(e=this.third)||void 0===e?void 0:e.equals(i))||(null===(s=this.fifth)||void 0===s?void 0:s.equals(i))||(null===(r=this.seventh)||void 0===r?void 0:r.equals(i)))}getRoot(){return this.root}setRoot(i){return this.root=i,this}getThird(){return this.third}setThird(i){return this.third=i,this}getFifth(){return this.fifth}setFifth(i){return this.fifth=i,this}getSeventh(){return this.seventh}setSeventh(i){return this.seventh=i,this}string(){const i=[this.root,this.third,this.fifth,this.seventh].filter((i=>i)).map((i=>null==i?void 0:i.string()));return i[this.inversion]=`{${i[this.inversion]}}`,i.join(" ")}}class a{constructor(i,t,e,s){this.base=i,this.alteration=t,this.inversion=e,this.relativeKey=s}static parse(i){const t=i.match(/^((b|#|)(III|iii|VII|vii|II|ii|IV|iv|VI|vi|I|i|V|v))(o7|7|)([a-d])?(\/((b|#|)(III|iii|VII|vii|II|ii|IV|iv|VI|vi|I|i|V|v)))?$/);if(null===t)throw`Could not parse chord '${i}'`;return new a(n.parse(t[1]),t[4],t[5]?a.INVERSIONS.indexOf(t[5]):0,t[6]?n.parse(t[7]):n.parse("I"))}resolve(i){if(null===this.base)throw"Cannot resolve chord with base 'null'";this.relativeKey&&(i=new r(i.degree(this.relativeKey.getDegree()),this.relativeKey.getTonality()));const t=i.degree(this.base.getDegree()).alterAccidental(this.base.getAccidental()).semitones()-i.degree(0).semitones(),e=i.degree(this.base.getDegree()+2,t+(this.base.getTonality()?4:3));let s,n;switch(this.alteration){case"":s=i.degree(this.base.getDegree()+4);break;case"o7":s=i.degree(this.base.getDegree()+4,t+6),n=i.degree(this.base.getDegree()+6,t+9);break;case"7":s=i.degree(this.base.getDegree()+4),n=i.degree(this.base.getDegree()+6)}return new I(i.degree(this.base.getDegree()).alterAccidental(this.base.getAccidental()),e,s,n,this.inversion)}progression(i){var t,e;const s=null===(t=i.SPECIFIC)||void 0===t?void 0:t[this.relativeKey.string()][this.toStringStem()],r=null==s?void 0:s.map(a.parse),n=(this.relativeKey.getTonality()?i.COMMON.MAJOR:i.COMMON.MINOR)[this.toStringStem()].map((i=>{const t=a.parse(i);return t.relativeKey=this.relativeKey,t}));return null!==(e=null==r?void 0:r.concat(n))&&void 0!==e?e:n}getInversion(){return this.inversion}setInversion(i){return this.inversion=i,this}toStringStem(){return this.base?this.base.string()+this.alteration+(this.inversion?a.INVERSIONS[this.inversion]:""):"start"}string(){let i=this.toStringStem();return 0===this.relativeKey.getDegree()&&0===this.relativeKey.getAccidental()||(i+="/"+this.relativeKey.string()),i}}var b,V,c;a.INVERSIONS=["a","b","c","d"],(V=b||(b={})).FULL={COMMON:{MAJOR:{start:["I","V","IV","ii","vi","iii"],I:["viib","iiic","iiib","iii","vic","vib","vi","ii7d","ii7c","ii7b","ii7","iic","iib","ii","IVc","IVb","IV","V7d","V7c","V7b","V7","Vc","Vb","V","Ic","Ib","I"],Ib:["IV","ii7b","ii7","iib","ii","V7d","V7c","Vc","vi","Ic","I"],Ic:["V7","V"],ii:["Ic","V","vi","iii","IV"],iib:["Ic","V"],iic:["iiib"],ii7:["Ic","V"],ii7b:["Ic","V"],ii7c:[],ii7d:["Vb"],iii:["viib","vi","IV","ii","vi"],iiib:["vi"],iiic:[],IV:["vi","vii","iii","Ic","I","V","ii"],IVb:["vii","Ic","I"],IVc:[],V:["iiic","iiib","iii","vi","iic","iib","ii","IV","Ic","Ib","I","Vb"],Vb:["vi","I"],Vc:["Ib","I"],V7:["vi","I"],V7b:["iiib","iii","vi","I"],V7c:["Ib","I"],V7d:["iii","Ib"],vi:["ii7d","ii7c","ii7b","ii7","iic","iib","ii","iiic","iiib","iii","Vb","V","IVb","IV","Ib"],vib:["ii"],vic:[],vii:["V/vi","iii","ii","V"],viib:["V/vi","I","iii"],viic:[],vii7:[],vii7b:[],vii7c:[],vii7d:[],viio7:[],viio7b:[],viio7c:[],viio7d:[]},MINOR:{start:["i","iv","V"],i:["VI","V7d","V7c","V7b","V7","Vc","Vb","V","#viib"],ib:["i"],ic:[],bII:[],bIIb:[],bIIc:[],ii:[],iib:[],iic:[],ii7:[],ii7b:[],ii7c:[],ii7d:[],III:["VI"],IIIb:[],IIIc:[],iv:["III","iv"],ivb:[],ivc:[],V:["bIIb","i"],Vb:["i"],Vc:["ib","i"],V7:["i"],V7b:["i"],V7c:["ib","i"],V7d:["ib"],VI:[],VIb:[],VIc:[],VII:[],VIIb:[],VIIc:[],"#vii":[],"#viib":["ib","i"],"#viic":[],"#viio7":["i"],"#viio7b":["ib","i"],"#viio7c":["ib"],"#viio7d":["ic"]}},SPECIFIC:{I:{start:[],I:["vii7/V"],Ib:[],Ic:[],ii:[],iib:[],iic:[],ii7:[],ii7b:[],ii7c:[],ii7d:[],iii:[],iiib:[],iiic:[],IV:[],IVb:[],IVc:[],V:["vii/V","V7d/V","V7c/V","V7b/V","V7/V"],Vb:[],Vc:[],V7:[],V7b:[],V7c:[],V7d:[],vi:["Vb/V"],vib:[],vic:[],vii:[],viib:[],viic:[],vii7:[],vii7b:[],vii7c:[],vii7d:[],viio7:[],viio7b:[],viio7c:[],viio7d:[]},II:{},III:{},IV:{start:["I","V","IV","ii","vi","iii"],I:[],Ib:[],Ic:[],ii:[],iib:[],iic:[],ii7:[],ii7b:[],ii7c:[],ii7d:[],iii:[],iiib:[],iiic:[],IV:[],IVb:[],IVc:[],V:[],Vb:[],Vc:[],V7:[],V7b:[],V7c:[],V7d:[],vi:[],vib:[],vic:[],vii:[],viib:[],viic:[],vii7:[],vii7b:[],vii7c:[],vii7d:[],viio7:[],viio7b:[],viio7c:[],viio7d:[]},V:{I:["V/I"],Ib:[],Ic:[],ii:[],iib:[],iic:[],ii7:[],ii7b:[],ii7c:[],ii7d:[],iii:[],iiib:[],iiic:[],IV:[],IVb:[],IVc:[],V:[],Vb:[],Vc:[],V7:[],V7b:["Ic/I","V/I"],V7c:["Vb/I"],V7d:[],vi:[],vib:[],vic:[],vii:[],viib:[],viic:[],vii7:["Ic/I","V/I"],vii7b:[],vii7c:[],vii7d:[],viio7:[],viio7b:[],viio7c:[],viio7d:[]},VI:{},VII:{},i:{},ii:{},iii:{},iv:{},v:{},vi:{},vii:{}}},V.PRIMARY_A={COMMON:{MAJOR:{start:["I","IV","V"],I:["IV","V","I"],IV:["V","I","IV"],V:["I","IV","V"]},MINOR:{start:["i","iv","V"],i:["iv","V","i"],iv:["V","i","iv"],V:["i","iv","V"]}}},V.PRIMARY_AB={COMMON:{MAJOR:{start:["I","Ib","IVb","IV","V","Vb"],I:["IVb","IV","Vb","V","Ib","I"],Ib:["IV","IVb","V","Vb","I","Ib"],IV:["Vb","V","Ib","I","IVb","IV"],IVb:["V","Vb","I","Ib","IV","IVb"],V:["Ib","I","IVb","IV","Vb","V"],Vb:["I","Ib","IV","IVb","V","Vb"]},MINOR:{start:["i","ib","ivb","iv","V","Vb"],i:["ivb","iv","Vb","V","ib","i"],ib:["iv","ivb","V","Vb","i","ib"],iv:["Vb","V","ib","i","ivb","iv"],ivb:["V","Vb","i","ib","iv","ivb"],V:["ib","i","ivb","iv","Vb","V"],Vb:["i","ib","iv","ivb","V","Vb"]}}},V.PRIMARY_ABC={COMMON:{MAJOR:{start:["I","Ib","Ic","IVc","IVb","IV","V","Vb","Vc"],I:["IVb","IV","Vb","V","Ib","I"],Ib:["IV","IVb","V","Vb","I","Ib"],IV:["Vb","V","Ib","I","IVb","IV"],IVb:["V","Vb","I","Ib","IV","IVb"],V:["Ib","I","IVb","IV","Vb","V"],Vb:["I","Ib","IV","IVb","V","Vb"],Vc:[]},MINOR:{start:["i","ib","ivb","iv","V","Vb"],i:["ivb","iv","Vb","V","ib","i"],ib:["iv","ivb","V","Vb","i","ib"],iv:["Vb","V","ib","i","ivb","iv"],ivb:["V","Vb","i","ib","iv","ivb"],V:["ib","i","ivb","iv","Vb","V"],Vb:["i","ib","iv","ivb","V","Vb"]}}},function(i){i.Printable=class{}}(c||(c={}))})();