var JSB;(()=>{"use strict";var t,e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};e.r(i),e.d(i,{Chord:()=>c,Dict:()=>v,Event:()=>l,Group:()=>r,Key:()=>a,Note:()=>s,Numeral:()=>h,Piece:()=>g,Pitch:()=>n,Resolution:()=>u,Tone:()=>o,Util:()=>d,Version:()=>I});class s{constructor(t,e){this.pitch=t,this.duration=e}static parse(t){const e=t.match(/^([A-G](bb|b|#|x|)[1-6])(_*)(\/*)(\.*)$/);if(null===e)throw`Could not parse note '${t}',`;return new s(n.parse(e[1]),2**(e[3].length-e[4].length)*1.5**e[5].length)}getPitch(){return this.pitch}setPitch(t){return this.pitch=t,this}getDuration(){return this.duration}setDuration(t){return this.duration=t,this}string(){let t=this.getPitch().string();switch(this.getDuration()){case.25:t+="𝅘𝅥𝅯";break;case.5:t+="♪";break;case.75:t+="♪.";break;case 1:t+="♩";break;case 1.5:t+="♩.";break;case 2:t+="𝅗𝅥";break;case 3:t+="𝅗𝅥.";break;case 4:t+="𝅝";break;case 6:t+="𝅝."}return t}}class r{constructor(t,e){this.notes=t,this.index=e}static parse(t){if(t.startsWith("(")&&t.endsWith(")")){const e=t.slice(1,-1).split(",").map((t=>s.parse(t)));return new r(e,0)}return new r([s.parse(t)],0)}static empty(){return new r([],0)}main(){return this.getNotes()[this.getIndex()]}at(t){return t<0&&(t=this.getNotes().length+t),this.getNotes()[t]}duration(){return this.getNotes().map((t=>t.getDuration())).reduce(((t,e)=>t+e))}getNotes(){return this.notes}setNotes(t){return this.notes=t,this}getIndex(){return this.index}setIndex(t){return this.index=t,this}string(){return this.getNotes().map((t=>t.string())).join(" ")}}class n{constructor(t,e){this.tone=t,this.octave=e}static parse(t){const e=t.match(/^([A-G](bb|b|#|x|))([1-6])$/);if(null===e)throw`Could not parse pitch '${t}'.`;return new n(o.parse(e[1]),Number(e[3]))}semitones(){return this.getTone().semitones()+12*this.getOctave()}near(t){return[new n(t,this.getOctave()-1),new n(t,this.getOctave()),new n(t,this.getOctave()+1)].sort(((t,e)=>Math.abs(this.semitones()-t.semitones())-Math.abs(this.semitones()-e.semitones())))}getTone(){return this.tone}setTone(t){return this.tone=t,this}getOctave(){return this.octave}setOctave(t){return this.octave=t,this}string(){return this.getTone().string()+this.getOctave()}group(t){return new r([new s(this,t)],0)}}class o{constructor(t,e){this.letter=t,this.accidental=e}static parse(t){const e=t.match(/^([A-G])(bb|x|b|#|)$/);if(null===e)throw`Could not parse tone '${t}'.`;return new o(o.LETTERS.indexOf(e[1]),o.ACCIDENTALS.indexOf(e[2]))}semitones(){return o.PITCHES[this.letter]+this.accidental}equals(t){return void 0!==t&&this.letter===t.letter&&this.accidental===t.accidental}near(t){return[new n(this,t.getOctave()-1),new n(this,t.getOctave()),new n(this,t.getOctave()+1)].sort(((e,i)=>Math.abs(t.semitones()-e.semitones())-Math.abs(t.semitones()-i.semitones())))}getLetter(){return this.letter}setLetter(t){return this.letter=t,this}getAccidental(){return this.accidental}setAccidental(t){return t>=-2&&t<=2&&(this.accidental=t),this}alterAccidental(t){const e=this.accidental+t;return e>=-2&&e<=2&&(this.accidental=e),this}string(){return o.LETTERS[this.letter]+o.ACCIDENTALS[this.accidental]}}o.ACCIDENTALS=["","#","x"],o.ACCIDENTALS[-2]="bb",o.ACCIDENTALS[-1]="b",o.LETTERS=["C","D","E","F","G","A","B"],o.PITCHES=[0,2,4,5,7,9,11];class a{constructor(t,e){this.tone=t,this.tonality=e}static parse(t){const e=t.match(/^(C|D|E|F|G|A|B)(bb|x|b|#|) (major|minor)$/);if(null===e)throw`Could not parse key '${t}'.`;return new a(o.parse(e[1]+e[2]),"major"===e[3])}degree(t,e){t%=7,null!=e||(e=(this.getTonality()?[0,2,4,5,7,9,11]:[0,2,3,5,7,8,10])[t]);const i=new o((this.getTone().getLetter()+t)%7,0);return i.setAccidental((e-i.semitones()+this.getTone().semitones()+18)%12-6),i}accidentals(){let t=2*this.getTone().getLetter()%7+7*this.getTone().getAccidental();return 3===this.getTone().getLetter()&&(t-=7),this.tonality||(t-=3),t}signature(){const t=this.accidentals();return[Math.floor((t+5)/7),Math.floor((t+3)/7),Math.floor((t+1)/7),Math.floor((t+6)/7),Math.floor((t+4)/7),Math.floor((t+2)/7),Math.floor(t/7)]}getTone(){return this.tone}setTone(t){return this.tone=t,this}getTonality(){return this.tonality}setTonality(t){return this.tonality=t,this}string(){return this.getTone().string()+" "+(this.getTonality()?"major":"minor")}}class h{constructor(t,e,i){this.accidental=t,this.degree=e,this.tonality=i}static parse(t){const e=t.match(/^(b|#|)(III|iii|VII|vii|II|ii|IV|iv|VI|vi|I|i|V|v)$/);if(null===e)throw`Could not parse numeral '${t}'.`;return new h(o.ACCIDENTALS.indexOf(e[1]),h.NUMERALS.indexOf(e[2].toLowerCase()),e[2]===e[2].toUpperCase())}getAccidental(){return this.accidental}setAccidental(t){return this.accidental=t,this}getDegree(){return this.degree}setDegree(t){return this.degree=t,this}getTonality(){return this.tonality}setTonality(t){return this.tonality=t,this}string(){return o.ACCIDENTALS[this.accidental]+h.NUMERALS[this.degree][this.tonality?"toUpperCase":"toLowerCase"]()}}h.NUMERALS=["i","ii","iii","iv","v","vi","vii"];class u{constructor(t,e,i,s,r){this.root=t,this.third=e,this.fifth=i,this.seventh=s,this.inversion=r}at(t){switch(t){case 0:return this.root;case 1:return this.third;case 2:return this.fifth;case 3:return this.seventh}}bass(){return this.at(this.inversion)}excludes(t){var e,i,s,r;return void 0!==t&&!((null===(e=this.root)||void 0===e?void 0:e.equals(t))||(null===(i=this.third)||void 0===i?void 0:i.equals(t))||(null===(s=this.fifth)||void 0===s?void 0:s.equals(t))||(null===(r=this.seventh)||void 0===r?void 0:r.equals(t)))}getRoot(){return this.root}setRoot(t){return this.root=t,this}getThird(){return this.third}setThird(t){return this.third=t,this}getFifth(){return this.fifth}setFifth(t){return this.fifth=t,this}getSeventh(){return this.seventh}setSeventh(t){return this.seventh=t,this}string(){const t=[this.root,this.third,this.fifth,this.seventh].filter((t=>t)).map((t=>null==t?void 0:t.string()));return t[this.inversion]=`{${t[this.inversion]}}`,t.join(" ")}}class c{constructor(t,e,i,s){this.base=t,this.alteration=e,this.inversion=i,this.relativeKey=s}static parse(t){const e=t.match(/^((b|#|)(III|iii|VII|vii|II|ii|IV|iv|VI|vi|I|i|V|v))(o7|7|)([a-d])?(\/((b|#|)(III|iii|VII|vii|II|ii|IV|iv|VI|vi|I|i|V|v)))?$/);if(null===e)throw`Could not parse chord '${t}'.`;return new c(h.parse(e[1]),e[4],e[5]?c.INVERSIONS.indexOf(e[5]):0,h.parse(e[6]?e[7]:"I"))}resolve(t){if(void 0===this.base)throw"Cannot resolve null chord.";this.relativeKey&&(t=new a(t.degree(this.relativeKey.getDegree()),this.relativeKey.getTonality()));const e=t.degree(this.base.getDegree()).alterAccidental(this.base.getAccidental()).semitones()-t.degree(0).semitones(),i=t.degree(this.base.getDegree()+2,e+(this.base.getTonality()?4:3));let s,r;switch(this.alteration){case"":s=t.degree(this.base.getDegree()+4);break;case"o7":s=t.degree(this.base.getDegree()+4,e+6),r=t.degree(this.base.getDegree()+6,e+9);break;case"7":s=t.degree(this.base.getDegree()+4),r=t.degree(this.base.getDegree()+6)}return new u(t.degree(this.base.getDegree()).alterAccidental(this.base.getAccidental()),i,s,r,this.inversion)}progression(t){var e,i,s,r,n;if(void 0===this.base)return t.start[this.relativeKey.getTonality()?"major":"minor"].map(c.parse);const o=null===(i=null===(e=t.specific)||void 0===e?void 0:e[this.relativeKey.string()])||void 0===i?void 0:i[this.stringStem()],a=null!==(s=null==o?void 0:o.map(c.parse))&&void 0!==s?s:[],h=t.common[this.relativeKey.getTonality()?"major":"minor"][this.stringStem()],u=null!==(r=null==h?void 0:h.map((t=>c.parse(t).setRelativeKey(this.relativeKey))))&&void 0!==r?r:[];return null!==(n=null==a?void 0:a.concat(u))&&void 0!==n?n:u}getBase(){return this.base}setBase(t){return this.base=t,this}getAlteration(){return this.alteration}setAlteration(t){return this.alteration=t,this}getInversion(){return this.inversion}setInversion(t){return this.inversion=t,this}getRelativeKey(){return this.relativeKey}setRelativeKey(t){return this.relativeKey=t,this}stringStem(){var t;return(null===(t=this.base)||void 0===t?void 0:t.string())+this.alteration+(this.inversion?c.INVERSIONS[this.inversion]:"")}string(){let t=this.stringStem();return t+="/"+this.relativeKey.string(),t}}c.INVERSIONS=["a","b","c","d"],function(t){t.FULL={start:{major:["I/I","V/I","IV/I","ii/I","vi/I","iii/I"],minor:["i/i","iv/i","V/i"]},common:{major:{I:["viib","iiic","iiib","iii","vic","vib","vi","ii7d","ii7c","ii7b","ii7","iic","iib","ii","IVc","IVb","IV","V7d","V7c","V7b","V7","Vc","Vb","V","Ic","Ib","I"],Ib:["IV","ii7b","ii7","iib","ii","V7d","V7c","Vc","vi","Ic","I"],Ic:["V7","V"],ii:["Ic","V","vi","iii","IV"],iib:["Ic","V"],iic:["iiib"],ii7:["Ic","V"],ii7b:["Ic","V"],ii7d:["Vb"],iii:["viib","vi","IV","ii","vi"],iiib:["vi"],IV:["vi","vii","iii","Ic","I","V","ii"],IVb:["vii","Ic","I"],V:["iiic","iiib","iii","vi","iic","iib","ii","IV","Ic","Ib","I","Vb"],Vb:["vi","I"],Vc:["Ib","I"],V7:["vi","I"],V7b:["iiib","iii","vi","I"],V7c:["Ib","I"],V7d:["iii","Ib"],vi:["ii7d","ii7c","ii7b","ii7","iic","iib","ii","iiic","iiib","iii","Vb","V","IVb","IV","Ib"],vib:["ii"],vii:["V/vi","iii","ii","V"],viib:["V/vi","I","iii"]},minor:{i:["VI","V7d","V7c","V7b","V7","Vc","Vb","V","#viib"],ib:["i"],III:["VI"],iv:["III","iv"],V:["bIIb","i"],Vb:["i"],Vc:["ib","i"],V7:["i"],V7b:["i"],V7c:["ib","i"],V7d:["ib"],"#viib":["ib","i"],"#viic":[],"#viio7":["i"],"#viio7b":["ib","i"],"#viio7c":["ib"],"#viio7d":["ic"]}},specific:{I:{I:["vii7/V"],V:["vii/V","V7d/V","V7c/V","V7b/V","V7/V"],vi:["Vb/V"]},V:{I:["V/I"],V7b:["Ic/I","V/I"],V7c:["Vb/I"],vii7:["Ic/I","V/I"]}}},t.PRIMARY_A={start:{major:["I","IV","V"],minor:["i","iv","V"]},common:{major:{I:["IV","V","I"],IV:["V","I","IV"],V:["I","IV","V"]},minor:{i:["iv","V","i"],iv:["V","i","iv"],V:["i","iv","V"]}}},t.PRIMARY_AB={start:{major:["I","Ib","IVb","IV","V","Vb"],minor:["i","ib","ivb","iv","V","Vb"]},common:{major:{I:["IVb","IV","Vb","V","Ib","I"],Ib:["IV","IVb","V","Vb","I","Ib"],IV:["Vb","V","Ib","I","IVb","IV"],IVb:["V","Vb","I","Ib","IV","IVb"],V:["Ib","I","IVb","IV","Vb","V"],Vb:["I","Ib","IV","IVb","V","Vb"]},minor:{i:["ivb","iv","Vb","V","ib","i"],ib:["iv","ivb","V","Vb","i","ib"],iv:["Vb","V","ib","i","ivb","iv"],ivb:["V","Vb","i","ib","iv","ivb"],V:["ib","i","ivb","iv","Vb","V"],Vb:["i","ib","iv","ivb","V","Vb"]}}},t.PRIMARY_ABC={start:{major:["I","Ib","Ic","IVc","IVb","IV","V","Vb","Vc"],minor:[]},common:{major:{I:["IVb","IV","Vb","V","Ib","I"],Ib:["IV","IVb","V","Vb","I","Ib"],IV:["Vb","V","Ib","I","IVb","IV"],IVb:["V","Vb","I","Ib","IV","IVb"],V:["Ib","I","IVb","IV","Vb","V"],Vb:["I","Ib","IV","IVb","V","Vb"],Vc:[]},minor:{start:["i","ib","ivb","iv","V","Vb"],i:["ivb","iv","Vb","V","ib","i"],ib:["iv","ivb","V","Vb","i","ib"],iv:["Vb","V","ib","i","ivb","iv"],ivb:["V","Vb","i","ib","iv","ivb"],V:["ib","i","ivb","iv","Vb","V"],Vb:["i","ib","iv","ivb","V","Vb"]}}}}(t||(t={}));const v=t;class l{constructor(t,e,i,s,r){this.map=0,this.s=t,this.a=e,this.t=i,this.b=s,this.cadence=r}getS(){return this.s}setS(t){return this.s=t,this}getA(){return this.a}setA(t){return this.a=t,this}getT(){return this.t}setT(t){return this.t=t,this}getB(){return this.b}setB(t){return this.b=t,this}getPart(t){switch(t){case"s":return this.getS();case"a":return this.getA();case"t":return this.getT();case"b":return this.getB()}}setPart(t,e){switch(t){case"s":return this.setS(e);case"a":return this.setA(e);case"t":return this.setT(e);case"b":return this.setB(e)}}duration(){var t,e,i,s;return null!==(s=null!==(i=null!==(e=null!==(t=this.getS().duration())&&void 0!==t?t:this.getA().duration)&&void 0!==e?e:this.getT().duration)&&void 0!==i?i:this.getB().duration)&&void 0!==s?s:0}getChord(){return this.chord}setChord(t){return this.chord=t,this}isCadence(){return this.cadence}}class g{constructor(){this.input=[],this.output=[],this.time={bar:0,event:0},this.maxTime={bar:0,event:0},this.key=a.parse("C major"),this.dictionary=v.FULL}parse(t,e){var i,s,n,o;const a=t.split(/[[|\]]/).filter((t=>""!==t)).map((t=>t.split(" ").filter((t=>""!==t))));for(let t=0;t<a.length;++t){null!==(i=(n=this.getInput())[t])&&void 0!==i||(n[t]=[]);for(let i=0;i<a[t].length;++i){const n=a[t][i].endsWith("@");n&&(a[t][i]=a[t][i].slice(0,-1)),null!==(s=(o=this.getInput()[t])[i])&&void 0!==s||(o[i]=new l(r.empty(),r.empty(),r.empty(),r.empty(),n)),this.getInput()[t][i][e]=r.parse(a[t][i])}}return this}previousPreviousOutputEvent(){let{bar:t,event:e}=this.time;if(--e<0){if(--t<0)return;e=this.getOutput()[t].length-1}if(--e<0){if(--t<0)return;e=this.getOutput()[t].length-1}return this.getOutput()[t][e]}previousOutputEvent(){let{bar:t,event:e}=this.time;if(--e<0){if(--t<0)return;e=this.getOutput()[t].length-1}return this.getOutput()[t][e]}outputEvent(){return this.getOutput()[this.getTime().bar][this.getTime().event]}harmonise(){for(this.setOutput([]),this.setMaxTime({bar:0,event:0}),this.setTime({bar:0,event:0});this.getTime().bar!==this.getInput().length;this.step()){if(this.getTime().bar<0)throw"Failed to harmonise.";this.getTime().bar>this.getMaxTime().bar?this.setMaxTime({bar:this.getTime().bar,event:this.getTime().event}):this.getTime().bar===this.getMaxTime().bar&&this.getTime().event>=this.getMaxTime().event&&(this.getMaxTime().event=this.getTime().event)}return this}step(){var t,e,i,s,o,a,u,v,g,b,d,I,V,m,p,T,f,E,y,A;const P=this.getInput()[this.getTime().bar][this.getTime().event];null!==(t=(f=this.getOutput())[E=this.time.bar])&&void 0!==t||(f[E]=[]),null!==(e=(y=this.getOutput()[this.time.bar])[A=this.time.event])&&void 0!==e||(y[A]=new l(r.empty(),r.empty(),r.empty(),r.empty(),P.isCadence()));const S=null!==(s=null===(i=this.previousOutputEvent())||void 0===i?void 0:i.getChord())&&void 0!==s?s:new c(void 0,"",0,new h(0,0,this.key.getTonality())),O=S.progression(this.dictionary).filter((t=>!this.outputEvent().isCadence()||["I","i","V"].includes(t.stringStem())));for(;this.outputEvent().map<O.length;++this.outputEvent().map){const t=O[this.outputEvent().map],e=t.resolve(this.key),i={s:void 0!==P.getS().main(),a:void 0!==P.getA().main(),t:void 0!==P.getT().main(),b:void 0!==P.getB().main()};if(["s","a","t","b"].filter((t=>i[t])).map((t=>P.getPart(t).duration())).some(((t,e,i)=>t!==i[0])))throw"Not all parts have the same duration.";if(!i.s)throw"Soprano line is not defined.";this.outputEvent().setS(P.getS()),this.outputEvent().setA(P.getA()),this.outputEvent().setT(P.getT()),this.outputEvent().setB(P.getB());const s={a:null!==(a=null===(o=this.previousOutputEvent())||void 0===o?void 0:o.getA().at(-1).getPitch())&&void 0!==a?a:n.parse("D4"),t:null!==(v=null===(u=this.previousOutputEvent())||void 0===u?void 0:u.getT().at(-1).getPitch())&&void 0!==v?v:n.parse("B3"),b:null!==(b=null===(g=this.previousOutputEvent())||void 0===g?void 0:g.getB().at(-1).getPitch())&&void 0!==b?b:n.parse("Eb3")};if(!i.b){const t=e.bass().near(s.b).filter((t=>t.semitones()>=28&&t.semitones()<=48&&t.semitones()<=this.outputEvent().getS().main().getPitch().semitones()-10))[0];this.outputEvent().setB(t.group(this.outputEvent().duration()))}if(e.excludes(null===(d=P.getS().main())||void 0===d?void 0:d.getPitch().getTone())||e.excludes(null===(I=P.getA().main())||void 0===I?void 0:I.getPitch().getTone())||e.excludes(null===(V=P.getT().main())||void 0===V?void 0:V.getPitch().getTone())||e.excludes(null===(m=P.getB().main())||void 0===m?void 0:m.getPitch().getTone()))continue;if(P.getB().main()&&!P.getB().main().getPitch().getTone().equals(e.bass()))continue;if(2===S.getInversion()&&(null===(T=null===(p=this.previousPreviousOutputEvent())||void 0===p?void 0:p.getChord())||void 0===T?void 0:T.string())===t.string())continue;const r=e.getSeventh()?[1,1,1,1]:[2,1,2,0];for(const t of["s","a","t","b"]){const i=[e.getRoot(),e.getThird(),e.getFifth(),e.getSeventh()].filter((t=>void 0!==t)).findIndex((e=>{var i;return e.equals(null===(i=this.outputEvent().getPart(t).main())||void 0===i?void 0:i.getPitch().getTone())}));-1!==i&&--r[i]}if(void 0===e.getSeventh()){if(0===r[0]&&(r[2]=1,0===r[2]))continue;0===r[2]&&(r[0]=1)}if(r.some((t=>t<0)))continue;let h;const c=r.map(((t,i)=>1===t?e.at(i):void 0)).filter((t=>void 0!==t));let l,f;if(i.a||i.t)i.a&&!i.t?(l=this.outputEvent().getA().main().getPitch(),h=1===c.length?[{a:l,t:f=c[0].near(s.t)[0],score:this.score(l,f)}]:[{a:l,t:f=c[0].near(s.t)[0],score:this.score(l,f)},{a:l,t:f=c[1].near(s.t)[0],score:this.score(l,f)}]):!i.a&&i.t?(f=this.outputEvent().getT().main().getPitch(),h=1===c.length?[{a:l=c[0].near(s.a)[0],t:f,score:this.score(l,f)}]:[{a:l=c[0].near(s.a)[0],t:f,score:this.score(l,f)},{a:l=c[1].near(s.a)[0],t:f,score:this.score(l,f)}]):h=[{a:l=this.outputEvent().getA().main().getPitch(),t:f=this.outputEvent().getT().main().getPitch(),score:this.score(l,f)}];else{let t=e.at(r.findIndex((t=>2===t)));switch(c.length){case 1:h=[{a:l=c[0].near(s.a)[0],t:f=t.near(s.t)[0],score:this.score(l,f)},{a:l=t.near(s.a)[0],t:f=c[0].near(s.t)[0],score:this.score(l,f)},{a:l=t.near(s.a)[0],t:f=t.near(s.t)[0],score:this.score(l,f)}].sort(((t,e)=>t.score-e.score));break;case 2:h=[{a:l=c[0].near(s.a)[0],t:f=c[1].near(s.t)[0],score:this.score(l,f)},{a:l=c[1].near(s.a)[0],t:f=c[0].near(s.t)[0],score:this.score(l,f)}].sort(((t,e)=>t.score-e.score));break;case 3:h=[{a:l=c[0].near(s.a)[0],t:f=c[1].near(s.t)[0],score:this.score(l,f)},{a:l=c[1].near(s.a)[0],t:f=c[0].near(s.t)[0],score:this.score(l,f)},{a:l=c[1].near(s.a)[0],t:f=c[2].near(s.t)[0],score:this.score(l,f)},{a:l=c[2].near(s.a)[0],t:f=c[1].near(s.t)[0],score:this.score(l,f)}].sort(((t,e)=>t.score-e.score))}}for(const e of h)if(e.score!==1/0&&(this.outputEvent().setA(e.a.group(this.outputEvent().duration())),this.outputEvent().setT(e.t.group(this.outputEvent().duration())),!(this.checkParallel("s","a")||this.checkParallel("s","t")||this.checkParallel("s","b")||this.checkParallel("a","t")||this.checkParallel("a","b")||this.checkParallel("t","b"))))return this.outputEvent().setChord(t),void(++this.getTime().event===this.getInput()[this.getTime().bar].length&&(this.getTime().event=0,++this.getTime().bar))}this.outputEvent().map=0,--this.getTime().event<0&&--this.getTime().bar>=0&&(this.getTime().event=this.getInput()[this.getTime().bar].length-1),this.getTime().bar>=0&&++this.outputEvent().map}score(t,e){var i,s,r,o;const a=this.outputEvent().getS().main().getPitch().semitones(),h=t.semitones(),u=e.semitones(),c=this.outputEvent().getB().main().getPitch().semitones(),v=null!==(s=null===(i=this.previousOutputEvent())||void 0===i?void 0:i.getA().at(-1).getPitch())&&void 0!==s?s:n.parse("D4"),l=null!==(o=null===(r=this.previousOutputEvent())||void 0===r?void 0:r.getT().at(-1).getPitch())&&void 0!==o?o:n.parse("B3"),g=Math.abs(h-v.semitones()),b=Math.abs(u-l.semitones());if(g>7||b>7||h>a||u>h||c>u||h>64||h<43||u<40||u>52)return 1/0;const d=a-h,I=h-u;return g+b+Math.sqrt((d*d+I*I)/2-(d+I)**2/4)}checkParallel(t,e){const i=this.previousOutputEvent();if(void 0===i)return!1;const s=i.getPart(t).at(-1).getPitch().semitones(),r=i.getPart(e).at(-1).getPitch().semitones(),n=this.outputEvent().getPart(t).at(0).getPitch().semitones(),o=this.outputEvent().getPart(e).at(0).getPitch().semitones(),a=(s-r)%12,h=(n-o)%12;return(0===a&&0===h||7===a&&7===h)&&s!==n&&r!==o}getInput(){return this.input}setInput(t){return this.input=t,this}getOutput(){return this.output}setOutput(t){return this.output=t,this}getTime(){return this.time}setTime(t){return this.time=t,this}getMaxTime(){return this.maxTime}setMaxTime(t){return this.maxTime=t,this}getKey(){return this.key}setKey(t){return this.key=t,this}getDictionary(){return this.dictionary}setDictionary(t){return this.dictionary=t,this}string(){return`[${this.getOutput().map((t=>t.map((t=>t.getS().string().padEnd(8))).join(" "))).join("|")}]\n[${this.getOutput().map((t=>t.map((t=>t.getA().string().padEnd(8))).join(" "))).join("|")}]\n[${this.getOutput().map((t=>t.map((t=>t.getT().string().padEnd(8))).join(" "))).join("|")}]\n[${this.getOutput().map((t=>t.map((t=>t.getB().string().padEnd(8))).join(" "))).join("|")}]\n[${this.getOutput().map((t=>t.map((t=>{var e;return null===(e=t.getChord())||void 0===e?void 0:e.string().padEnd(8)})).join(" "))).join("|")}]`}}var b;!function(t){t.Printable=class{}}(b||(b={}));const d=b,I="1.7.13";JSB=i})();